<!-- udacity2.0 -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Solution: Async/Await II</title>
  <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="../assets/css/plyr.css">
  <link rel="stylesheet" href="../assets/css/katex.min.css">
  <link rel="stylesheet" href="../assets/css/jquery.mCustomScrollbar.min.css">
  <link rel="stylesheet" href="../assets/css/styles.css">
  <link rel="shortcut icon" type="image/png" href="../assets/img/udacimak.png" />
</head>

<body>
  <div class="wrapper">
    <nav id="sidebar">
  <div class="sidebar-header">
    <h3>Sequencing Events - Async/Await</h3>
  </div>

  <ul class="sidebar-list list-unstyled CTAs">
    <li>
      <a href="../index.html" class="article">Back to Home</a>
    </li>
  </ul>

  <ul class="sidebar-list list-unstyled components">
    <li class="">
      <a href="01. Lesson Introduction.html">01. Lesson Introduction</a>
    </li>
    <li class="">
      <a href="02. Getting  Started with TryCatch.html">02. Getting  Started with Try/Catch</a>
    </li>
    <li class="">
      <a href="03. Exercise TryCatch Practice.html">03. Exercise: Try/Catch Practice</a>
    </li>
    <li class="">
      <a href="04. Solution TryCatch Practice.html">04. Solution: Try/Catch Practice</a>
    </li>
    <li class="">
      <a href="05. Why AsyncAwait is Important.html">05. Why Async/Await is Important</a>
    </li>
    <li class="">
      <a href="06. Introduction to AsyncAwait.html">06. Introduction to Async/Await</a>
    </li>
    <li class="">
      <a href="07. Exercise AsyncAwait I.html">07. Exercise: Async/Await I</a>
    </li>
    <li class="">
      <a href="08. Solution AsyncAwait I.html">08. Solution: Async/Await I</a>
    </li>
    <li class="">
      <a href="09. Error Handling with AsyncAwait.html">09. Error Handling with Async/Await</a>
    </li>
    <li class="">
      <a href="10. When (and When Not) to Use AsyncAwait.html">10. When (and When Not) to Use Async/Await</a>
    </li>
    <li class="">
      <a href="11. Exercise AsyncAwait II.html">11. Exercise: Async/Await II</a>
    </li>
    <li class="">
      <a href="12. Solution AsyncAwait II.html">12. Solution: Async/Await II</a>
    </li>
    <li class="">
      <a href="13. Quizzes AsyncAwait .html">13. Quizzes: Async/Await </a>
    </li>
    <li class="">
      <a href="14. Lesson Conclusion.html">14. Lesson Conclusion</a>
    </li>
    <li class="">
      <a href="15. Lesson Glossary.html">15. Lesson Glossary</a>
    </li>
    <li class="">
      <a href="16. Course Recap.html">16. Course Recap</a>
    </li>
    <li class="">
      <a href="17. Congratulations!.html">17. Congratulations!</a>
    </li>
  </ul>

  <ul class="sidebar-list list-unstyled CTAs">
    <li>
      <a href="../index.html" class="article">Back to Home</a>
    </li>
  </ul>
</nav>

    <div id="content">
      <header class="container-fluild header">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <div class="align-items-middle">
                <button type="button" id="sidebarCollapse" class="btn btn-toggle-sidebar">
                  <div></div>
                  <div></div>
                  <div></div>
                </button>

                <h1 style="display: inline-block">12. Solution: Async/Await II</h1>
              </div>
            </div>
          </div>
        </div>
      </header>

      <main class="container">
        <div class="row">
          <div class="col-12">
            <div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="exercise-solutions">Exercise Solutions</h2>
<p>Here are the solutions for each challenge.</p>
<h4 id="challenge-1">Challenge 1</h4>
<pre><code>const printStatusMessage = async (status) =&gt; {
    try {
        const animalsList = await animalsByConservationStatus(status);
        console.log(animalsList)
        message = `Animals listed as ${status} are: ${animalsList.join(', ')}`;
        console.log(message);
    } catch(error) {
        console.error(error);
        console.log(`There are no animals with status: ${status}`)
    }
}

printStatusMessage("critical");
printStatusMessage("extinct");</code></pre>
<p>Notice where the <code>async</code> word is added. When you save a function to a variable name with arrow function syntax, you need to make sure <code>async</code> goes <strong>before the function definition</strong> instead of before the variable name. It can be tempting to want to write this instead:</p>
<pre><code>const async printStatusMessage = (status) =&gt; {...</code></pre>
<p>But this would not be correct because when this runs, printStatusMessage is not a function, just a variable name. That is why this syntax is correct to save an <code>async</code> function to a variable:</p>
<pre><code>const printStatusMessage = async (status) =&gt; {...</code></pre>
<h4 id="challenge-2">Challenge 2</h4>
<pre><code>endangeredAnimals = ["saola", "green turtle", "amur leopard", "deer"];

const printAnimalMessage = async (animal) =&gt; {
    try {
        const info = await fetchAnimalByName(animal);
        const message = `The ${info.common_name} is ${info.conservation_status} on the endangered list`;
        console.log(message);
    } catch(error) {
        console.error(`There was a problem fetching: ${animal}`)
    };
};

endangeredAnimals.forEach(animal =&gt; printAnimalMessage(animal));</code></pre>
<h4 id="challenge-3">Challenge 3</h4>
<pre><code>animal1 = "vaquita";
animal2 = "mouse";

const printAnimalFacts = async (animal) =&gt; {
    try {
        const data = await fetchAnimalByName(animal);
        const message = `The ${data.common_name} (${data.species}) is an endangered animal with ${data.population !== null ? data.population : "an unkown number of"} individuals in the wild in their home region of ${data.region}`;
        console.log(message);
    } catch(error) {
        console.error(error)
    } finally {
        console.log(`The ${animal} was searched.`)
    }
};

printAnimalFacts(animal1);
printAnimalFacts(animal2);</code></pre>
<p><code>Finally</code> statements work with Async/await too!</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="bonus-round---challenge-4">Bonus Round - Challenge 4</h2>
<p>This code challenge was much harder than the others and forces you to use everything you've learned in the course so far. To be very clear, you are not expected to have solved this correctly the first time, I would put this as an advanced JavaScript challenge. But even if you didn't get the code working in the challenge, take a look at this code example because it has many things to teach us about Async/await and Promises.</p>
<h4 id="challenge-4">Challenge 4</h4>
<pre><code>const printAnimalRegions = async (status) =&gt; {
    try {
        const animalsList = await animalsByConservationStatus(status);
        const getAnimals = animalsList.map((animal) =&gt; {
            return fetchAnimalByName(animal).catch(err =&gt; console.log(err));
        });

        const regions = await Promise.allSettled(getAnimals)
        .then(results =&gt; {
            const regions = results.map(result =&gt; result.value.region);
            return regions;
        })
        .catch(error =&gt; console.log(error));

        const message = `Animals with an endangered status of ${status} can be found in the following regions: ${regions.join(', ')}`;

        console.log(message);
    } catch(error) {
        console.log(error);
    } finally {
        console.log(`Search complete for regions with animals of status: ${status}`);
    };
};

printAnimalRegions("critical");
printAnimalRegions("threatened");</code></pre>
<p>There is a lot going on here, so I'm going to break down the most important lines. First off, notice that this is a situation where we need one Promise to resolve before we have the information we need to start the second. In this case, we need to have the list of animals with the requested endangered status back from the API (animalsByConservationStatus), because our second action is to request the specific information for each animal by name (fetchAnimalByName).</p>
<p>So we await the result of animalsByConservationStatus so that animalsList is an array of animal names. Now, we need to request the information for each animal  in that list. To do this, we have to map over the list of names, and for each animal we make a request to get its information. So take a look at the variable <code>getAnimals</code>, it is the result of a map function, therefore it is an array. But an array of what? Promises!</p>
<p>And here is where this example takes the difficulty to a new level, we now have one Promise per animal in <code>animalsList</code> stored in an array (<code>getAnimals</code>)!  That might trigger your memory from the Promises lesson - there are Promise methods specifically for handling multiple Promises. In this case, <code>Promise.allSettled</code> is the one we want and we are going to pass it the array of the Promises <code>getAnimals</code>.  </p>
<p>But lets take it a little further. Promise.allSettled itself returns a what? A Promise. A single Promise. That means that we can <code>await</code> the result of Promise.allSettled. Take a look at the <code>.then</code> clause of the Promise.allSettled and notice that we are returning only the <code>region</code> value of each result. So, Promise.allSettled waits for each <code>getAnimal</code> Promise to resolve, then takes the data and pulls out the region. The resulting array is stored in the constant <code>regions</code>. </p>
<h2 id="second-try">Second Try</h2>
<p>To get a better feel for everything happening in this example, use the workspace below and add console logs at the steps I outline above to make sure you understand what is happening. And if you are particularly ambitious, you could try implementing this with just Promises, as the attempt will help you get a feel for why the Async/await syntax is so helpful.</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div class="jumbotron">
  <h3>Code</h3>

  <p class="lead">If you need a code on the <a href="https://github.com/udacity"
    target="_blank">https://github.com/udacity</a>. </p>

  </ul>
</div>

</div>
<div class="divider"></div>
          </div>

          <div class="col-12">
            <p class="text-right">
              <a href="13. Quizzes AsyncAwait .html" class="btn btn-outline-primary mt-4" role="button">Next Concept</a>
            </p>
          </div>
        </div>
      </main>

      <footer class="footer">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <p class="text-center">
                <a href="https://us-udacity.github.io/" target="_blank">【udacity2.0 】If you need more courses, please add wechat：udacity6</a>
              </p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </div>


  <script src="../assets/js/jquery-3.3.1.min.js"></script>
  <script src="../assets/js/plyr.polyfilled.min.js"></script>
  <script src="../assets/js/bootstrap.min.js"></script>
  <script src="../assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="../assets/js/katex.min.js"></script>
  <script>
    // Initialize Plyr video players
    const players = Array.from(document.querySelectorAll('video')).map(p => new Plyr(p));

    // render math equations
    let elMath = document.getElementsByClassName('mathquill');
    for (let i = 0, len = elMath.length; i < len; i += 1) {
      const el = elMath[i];

      katex.render(el.textContent, el, {
        throwOnError: false
      });
    }

    // this hack will make sure Bootstrap tabs work when using Handlebars
    if ($('#question-tabs').length && $('#user-answer-tabs').length) {
      $("#question-tabs a.nav-link").on('click', function () {
        $("#question-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
      $("#user-answer-tabs a.nav-link").on('click', function () {
        $("#user-answer-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
    } else {
      $("a.nav-link").on('click', function () {
        $(".tab-pane").hide();
        $($(this).attr("href")).show();
      });
    }

    // side bar events
    $(document).ready(function () {
      $("#sidebar").mCustomScrollbar({
        theme: "minimal"
      });

      $('#sidebarCollapse').on('click', function () {
        $('#sidebar, #content').toggleClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
      });

      // scroll to first video on page loading
      if ($('video').length) {
        $('html,body').animate({ scrollTop: $('div.plyr').prev().offset().top});
      }

      // auto play first video: this may not work with chrome/safari due to autoplay policy
      if (players && players.length > 0) {
        players[0].play();
      }

      // scroll sidebar to current concept
      const currentInSideBar = $( "ul.sidebar-list.components li a:contains('12. Solution: Async/Await II')" )
      currentInSideBar.css( "text-decoration", "underline" );
      $("#sidebar").mCustomScrollbar('scrollTo', currentInSideBar);
    });
  </script>
</body>

</html>
